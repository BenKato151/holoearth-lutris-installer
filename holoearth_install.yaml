name: Holoearth Beta
game_slug: holoearth-beta
version: holoearth-installer
slug: holoearth-beta
runner: wine
notes: "IMPORTANT - READ BEFORE INSTALL\r\n\
\ - After the installation of firefox finished, uncheck the checkbox since you don't need to launch firefox first.\r\n\
\ This installer will continue.\r\n\
\ - After the installation of the Holoearth Launcher, keep the checkbox enabled and start\
\ the Holoearth Launcher.\r\n - Download the base game.\r\n\
\ - When finished, close the Holoearth Launcher and this installer will continue.\r\n\
\ - Only after the installation complete message of lutris appears, you can start Holoearth from lutris.
"

script:
  game:
    exe: $GAMEDIR/.wine/drive_c/Program Files/COVER corp/Holoearth Launcher/Launcher.exe
    arch: win64
    prefix: $GAMEDIR/.wine
    working_dir: $GAMEDIR/

  files:
    - holoearth_installer_file: "https://cdn.holoearth.com/launcher/v1.4.0/1d466f71-79a7-46f2-a702-48bd5b5f4577/HoloearthSetup.exe"
    - firefox_installer_file:
        url: "https://download.mozilla.org/?product=firefox-esr-latest-ssl&os=win64&lang=en-US"
        filename: firefox_esr_installer.exe

  installer:
    - write_file:
        file: $GAMEDIR/regedit_files/set_default_browser.reg
        description: "Write Registry file to set Firefox as the default browser for HTTP and HTTPS"
        content: |
          Windows Registry Editor Version 5.00

          [HKEY_CLASSES_ROOT\https\shell\open\command]
          @="\"C:\\Program Files\\Mozilla Firefox\\firefox.exe\" \"%1\""

          [HKEY_CLASSES_ROOT\http\shell\open\command]
          @="\"C:\\Program Files\\Mozilla Firefox\\firefox.exe\" \"%1\""

    - task:
        name: set_regedit_file
        description: "Set Firefox as the default browser for HTTP and HTTPS"
        filename: $GAMEDIR/regedit_files/set_default_browser.reg
        prefix: $GAMEDIR/.wine

    - write_file:
        file: $GAMEDIR/regedit_files/window_decoration.reg
        description: "Write Registry file to disable window decoration"
        content: |
          Windows Registry Editor Version 5.00

          [HKEY_CURRENT_USER\Software\Wine\X11 Driver]
          "Decorated"="N"

    - task:
        name: set_regedit_file
        description: "Disable window decoration in winecfg"
        filename: $GAMEDIR/regedit_files/window_decoration.reg
        prefix: $GAMEDIR/.wine

    - task:
        name: winetricks
        description: "Install japanese fonts and ucrtbase2019 with Winetricks"
        prefix: $GAMEDIR/.wine
        app: cjkfonts fakejapanese corefonts ucrtbase2019

    - task:
        name: wineexec
        description: "Install Firefox (Uncheck the box after installation, you don't need to launch it)"
        executable: firefox_installer_file
        prefix: $GAMEDIR/.wine

    - execute:
        description: "Create Temp directory to prevent Holoearth from crashing"
        command: mkdir -p $GAMEDIR/.wine/drive_c/users/$(whoami)/AppData/Local/Temp

    - task:
        name: wineexec
        description: "Run the Holoearth Launcher installer (Keep the checkbox enabled, this will start the launcher. Download the base game and after the installation, you can close it to continue this installation script)"
        executable: holoearth_installer_file
        prefix: $GAMEDIR/.wine

  system:
    env:
      DXVK_HUD: full
